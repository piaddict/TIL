# SQL Anti Patterns

## 무단횡단

다대다 관계를 위한 교차테이블 생성을 피하기 위해 쉼표로 구분된 목록을 사용하는 경우

### 무단횡단 안티패턴

- 해당 데이터에서 일치하는 데이터를 검색하는 경우
- 해당 데이터를 FK로 사용해서 연관 데이터를 조회하는 경우 조인 자체도 어려울 뿐더러 조인시 인덱스를 활용할 기회가 사라진다
- 집계쿼리는 행의 그룹에 대해 사용하도록 되어 있으므로 사용이 어렵다
- 데이터 목록 정렬이 어렵다
- 연관 데이터의 갱신이 어렵다
- 입력 데이터의 유효성 검증이 어렵다
- 구분자 문자로 어떤것을 선택해야 할지에 대한 문제(comma를 사용한다면 본문의 comma는 어떻게 처리할 것인가?)
- 데이터 타입에 따라 목록 저장 길이 제한이 존재한다

### 안티패턴 사용이 합당한 경우

- 특정 쿼리는 역정규화를 적용해 성능을 높일 수 있다
- 이 경우 목록안의 개별항목에 접근할 필요가 없어야 한다
- 역정규화 적용은 보수적으로 접근해야 한다

### 해법: 교차 테이블 생성

- 어떤 테이블이 FK로 두 테이블을 참조할 때 이를 교차 테이블이라 한다
- 별도의 테이블에 각각의 행으로 저장하고 두 테이블 사이 다대다 관계를 생성한다
- 목록에 항목 추가/삭제는 교차 테이블에 행 삽입 삭제로 할 수 있다
